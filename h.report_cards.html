<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <title>Breman Islamic Academy - Report Cards</title>
    <style>
        @media (min-width: 768px) {
            .content.shifted {
                margin-left: 200px; /* Shift content when sidebar is open */}}
        /* Small screens: No shifting */
        @media (max-width: 767px) {.content {margin-left: 0; /* No shifting on small screens */}}

        .content {transition: margin-left 0.3s ease;
                  margin-left: 0;
                  padding: 20px;
                  display: flex;
                 flex-direction: column;
                 align-items: center; /* Center content */}
        .popup-content {
            background-color: #e0f7fa; /* Different color for content inside the popup */
            padding: 10px; /* Padding for content */
            margin: 10px 0; /* Margin for spacing */
        }
        #generate {background: seagreen; 
                   color: white; padding: 3px 5px;
                   border-radius: 20px; font-size: 15px;
                   margin-top: 50px; border: none; z-index: 90;}
        fieldset {border: 3px solid green;
                  border-radius: 8px;
                  padding: 2em 0 2em;
                  margin-left: auto;
                  height: 100%;
                  max-height: 25em;
                  margin-top: 20%;
                  background: #f9f9f9;
                  width: 100%; /* Set the width of the fieldset */
                  max-width: 40em; /* Max width for larger screens */
                  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Optional shadow for better visibility */}
        @media (max-width: 767px) {fieldset {margin-top: 9%;}}

        legend  {background: gold; color: blue; padding: 5px; border-radius: 15px;
                 width: 70%; max-width: 40em;}
        p       {margin-top: 2em;}
        #studentName, select   {border-radius: 1em; margin-left: 1em;}
    </style>
</head>
<body>
    <header class="header"></header>
    <nav class="navbar">
        <div class="left_me">
            <button id="toggle-button" onclick="toggleSidebar()" title="Toggle Sidebar">Toggle Sidebar</button>
        </div>
        <div class="right_us">
            <button title="Current Page" id="current">Report Cards</button>
            <button onclick="openEmailPopup()" id="mail">Email</button>
            <button onclick="openContactPopup()" id="call">Contact</button>
            <form action="https://www.google.com/search" method="get" style="display: inline;">
                <input type="text" name="q" placeholder="Search Google" id="input" required>
                <button type="submit" id="search" style="border: none; background: burlywood;"><b style="color: blue; font-size: 15px;">GO</b></button>
            </form>
        </div>
    </nav>
    <div class="main-container">
        <aside class="sidebar" id="sidebar">
            <img src="i.Breman Islamic Bage 1.jpg" alt="School Badge" id="side">
            <br><b style="margin-left: 60px;">BIA.EDU</b><br><b style="margin-left: 35px;">BREMAN ASIKUMA</b>
            <ul>
                <li><button id="home" class="button"><a href="index.html">Home</a></button></li>
                <li><button id="report_cards" class="button active"><a href="h.report_cards.html" style="color: red;">Report Cards</a></button></li>
                <li><button id="exams" class="button"><a href="exams.html">Exams</a></button></li>
                <li><button id="gallery" class="button"><a href="gallery.html">Gallery</a></button></li>
                <li><button id="audios" class="button"><a href="audios.html">Audios</a></button></li>
                <li><button id="admission" class="button"><a href="admission.html">Admission</a></button></li>
            </ul>
        </aside>
        <main class="content" id="content">
            <form id="loginForm">
            <fieldset class="report_cards">
                <legend><b>Student Report Card Checking</b></legend>
                    <p style="margin-left: 2.5em; margin-right: 3em;">
                        <label for="studentName" ><b>Student Name:</b></label>
                        <input type="text" id="studentName" placeholder="enter your full name" 
                        style="text-transform: uppercase; width: 15em;" required>
                    </p>
                    <p style="margin-left: 1.5em; margin-right: 2em;">
                        <b><label for="classSelect">Class:</label></b>
                        <select id="classSelect" required>
                            <option>- - - Select Class - - -</option>
                            <option>Nursery</option>
                            <option>KG 1</option>
                            <option>KG 2</option>
                            <option>Basic 1</option>
                            <option>Basic 2</option>
                            <option>Basic 3</option>
                            <option>Basic 4</option>
                            <option>Basic 5</option>
                            <option>Basic 6</option>
                            <option>Form 1</option>
                            <option>Form 2</option>
                            <option>Form 3</option>
                        </select>
                    </p>
                    <p style="margin-left: 1.5em; margin-right: 2em;">
                        <b><label for="termSelect" >Term:</label></b>
                        <select id="termSelect" required>
                            <option>- - - Select Term - - -</option>
                            <option>Term 1</option>
                            <option>Term 2</option>
                            <option>Term 3</option>
                        </select>
                    </p>
                    <p style="margin-right: 2em;">
                        <b><label for="yearSelect">Academic Year:</label></b>
                        <select id="yearSelect" required>
                            <option>- - -Select Academic Year- - -</option>
                            <option>2023/2024</option>
                        </select>
                    </p>
                    <p>
                        <button id="generate" type="submit" style="
                                                     "><b>Generate Report Card</b></button>
                    </p>
            </fieldset>
            </form>
            <div id="result" style="display:none;"></div>
        </main>
    </div>

        <div class="overlay" id="overlay"></div>
    <div class="popup" id="emailPopup">
        <div class="popup-header">
            <h2>Email for Support</h2>
        </div>
        <div class="popup-content" id="popupContent">
        <p>Are you confused about something?<br>Don't worry, send a mail to:</p>
        <p><br><input id="help" type="email" value="abubakarabdulai@gmail.com" readonly style="position: absolute;
                                                                           left: 10%; bottom: 8.5em; width: 75%; padding-left: 5px;
                                                                           border-radius: 6px; text-align: center;"></p>
                                                                       </div>
        <div class="popup-footer">
            <button onclick="closePopup()">Close</button>
        </div>
        </div>

        <div class="popup" id="contactPopup">
        <div class="popup-header">
            <h2>Contact for Help</h2>
        </div>
        <div class="popup-content" id="popupContent">
        <p>Do you want to talk to the school management?</p>
        <p><strong>Headmaster Name:</strong>
        <input type="text" value="Abdulai Abubakar" readonly style="border-radius: 5px; width: 80%; text-align: center;"></p>
        <p><strong>Contact:</strong>
        <input type="text" value="0241303485" readonly style="border-radius: 5px; width: 50%; text-align: center;"></p>
        </div>
        <div class="popup-footer">
            <button onclick="closeContactPopup()">Close</button>
        </div>
        </div>

        <!-- Confirmation Popup -->
    <div class="overlay" id="confirmationOverlay" style="display:none;"></div>
        <div class="popup" id="confirmationPopup" style="display:none;">
        <div class="popup-header">
            <h2>Confirm Details</h2>
        </div>
        <div class="popup-content" id="popupContent">
        <p><strong>Student Name:</strong> <span id="confirmStudentName"></span></p>
        <p><strong>Class:</strong> <span id="confirmClass"></span></p>
        <p><strong>Term:</strong> <span id="confirmTerm"></span></p>
        <p><strong>Academic Year:</strong> <span id="confirmAcademicYear"></span></p>
        </div>
         <div class="popup-footer">
        <button id="agreeButton" style="background: green; color: white;">Agree</button>
        <button onclick="closeConfirmationPopup()" style="background: red; color: white;">Disagree</button>
        </div>
    </div>

    <script type="text/javascript" src="script.js"></script>
    <script type="text/javascript" src="data.js"></script>
<script>
         function calculateAggregate(student) {
            const grades = Object.entries(student.grades).map(([subject, grade]) => ({ subject, grade: parseInt(grade) }));

            let mandatoryGrades = [];
            let remainingGrades = [];

            if (student.class === "Nursery") {
                // Sum all grades for Nursery
                const total = grades.reduce((sum, g) => sum + g.grade, 0);
                return total;
            } else if (student.class === "Basic 1" || student.class === "Basic 4") {
                // Mandatory subjects
                mandatoryGrades = grades.filter(g => ["english language", "history", "mathematics", "science"].includes(g.subject));
                remainingGrades = grades.filter(g => !["english language", "history", "mathematics", "science"].includes(g.subject));
            } else if (student.class === "Form 1") {
                // Mandatory subjects
                mandatoryGrades = grades.filter(g => ["english language", "mathematics", "science", "social studies"].includes(g.subject));
                remainingGrades = grades.filter(g => !["english language", "mathematics", "science", "social studies"].includes(g.subject));
            }

            // Calculate the sum of mandatory grades
            const mandatoryTotal = mandatoryGrades.reduce((sum, g) => sum + g.grade, 0);
            
            // Get two lowest grades from remaining grades
            const lowestGrades = remainingGrades.map(g => g.grade).sort((a, b) => a - b).slice(0, 2);
            
            // Final aggregate
            const aggregate = mandatoryTotal + lowestGrades.reduce((sum, grade) => sum + grade, 0);
            return aggregate; // Return as a string with 2 decimal places
        }

        function updateAggregates() {
            reportCards.forEach(student => {
                student.aggregate = calculateAggregate(student);
            });
        }

        // Call the function to update aggregates
        updateAggregates();

        // Log the updated report cards to see results
        console.log(reportCards);


        document.getElementById("loginForm").addEventListener("submit", function(event) {
            event.preventDefault();

            const name = document.getElementById("studentName").value.toUpperCase();
            const classValue = document.getElementById("classSelect").value;
            const term = document.getElementById("termSelect").value;
            const academicYear = document.getElementById("yearSelect").value;

            // Show confirmation popup
            document.getElementById("confirmStudentName").innerText = name;
            document.getElementById("confirmClass").innerText = classValue;
            document.getElementById("confirmTerm").innerText = term;
            document.getElementById("confirmAcademicYear").innerText = academicYear;

            document.getElementById("confirmationOverlay").style.display = "block";
            document.getElementById("confirmationPopup").style.display = "block";
        });

        document.getElementById("agreeButton").addEventListener("click", function() {
            const name = document.getElementById("confirmStudentName").innerText;
            const classValue = document.getElementById("confirmClass").innerText;
            const term = document.getElementById("confirmTerm").innerText;
            const academicYear = document.getElementById("confirmAcademicYear").innerText;

            const student = reportCards.find(s => 
                s.studentName === name && 
                s.class === classValue && 
                s.term === term && 
                s.academicYear === academicYear
            );

            if (student) {
                // Store student data in local storage
                localStorage.setItem("studentData", JSON.stringify(student));

                // Redirect to report_cards_display.html
                window.location.href = "h.report_cards_display.html";
            } else {
                alert("Student not found. Enter the right Student Name, Class, Term, and Academic Year.");
                closeConfirmationPopup();
            }
        });

        function closeConfirmationPopup() {
            document.getElementById("confirmationOverlay").style.display = "none";
            document.getElementById("confirmationPopup").style.display = "none";
        }
    </script>
    <footer class="footer">
        <audio controls id="audio" autoplay loop>
            <source src="m.background-music.aac" type="audio/mpeg">
        </audio>
        <marquee>- - - Motto: Sovereignty Belongs to Allah - - -</marquee>
    </footer>
</body>
</html>
